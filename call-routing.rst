Маршрутизация вызовов
=====================

От клиентов
-----------

Клиентское оборудование отправляет все вызовы на сервер pbx.rcsnet.ru. В поле "To" клиентское оборудование должно указать идентификатор вызываемого
абонента (до символа "@") и домен (после символа "@"). По наименованию домена определяется в какую виртуальную АТС поступит на авторизацию и
обработку звонок.
После авторизации звонка производится предварительное преобразования идентификатора вызываемоего абонента. Например, если идентиикатор наинается
с "8" и последующие цифры не "10", то заменить на "+7". Другой пример, заменить в номере цифры "9810", на "+".

Далее выполняется анализ идентификатора вызываемого абонента на сответствие формату международнего номера. Международний номер
определяется в следующих случаях:

1. Номер принадлежит экстренным службам. Например "112" - МЧС, "01" и "101" - пожарная служба, "02" и "102" - полиция и т.п.;
2. Первый символы "+7" и далее 10 цифр - вызов абонента российского сегмента телефонной сети. Пример +74959337786;
3. Первый символ "+" и далее не менее 6 цифр - вызов абонента за пределами России.

Если номер не является номером в международном формате или номер принадлежит виртуальной АТС клиента, то звонок обрабатывается согласно плана
нумерации (callflows) виртуальной АТС клиента.
Если номер в международнем формате и номер не принадлежит виртуальной АТС клиента, то звонок передается на маршурутизацию вызова на пограничные
sip-сервера.

На пограничном сервере выполняются проверки:

1. АОН вызываеющего абонента;
2. отсутствие превышения лимитов на междугороднию связь;
3. отсутсвия блокировки вызова биллинговой системой.

В случае если проверки успешные, то определяется принадлежит ли номер назначения сети "Русцентросвязь". Если проверка успешная (номер сети
Русцентросвязь), то звонок направляется на клиентский sip-сервер. Если проверка не успешная, то звонок направляется в ТФОП.

От операторов
-------------

При поступлении вызова от оператора телефонный номер назначения и АОН вызывающего абонента прнобразуются к формату междунороднего номера.
Если номер назначения не принадлежит сети "Русценросвязь", то обработка звонка завершается. Если номер принадлежит сети "Русцентросвязь", то вызов
передается на обработку на клиентский sip-сервер.
