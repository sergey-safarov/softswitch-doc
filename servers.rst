Состав комплекса
================

Определения и согращения
ПО - программное обеспечение

Комплекс состоит из серверов выполняющих функции:

1. базы данных;
2. сервера приложений;
3. sip-сервера;
4. веб-сервера.

В качестве операционной системы на серверах используется "CentOS 7 x64" с установленным программым обеспечением реализующим требуемую функцию. Все сервера настроены на работу на базе IPv6 сети. Для случаев где необходимо обеспечить применение IPv4 адресов, это оговаривается отдельно. Если не сказано отдельно, то везде используется продукты с открытым исходным кодом. Каждый из типов серверов представлен двумя виртуальными машинами. Перечень виртуальных машин представлен в таблице ниже.

.. table:: Перечень виртуальных машин

  =====================   =====================  =========================
  Наименование сервера    DNS имя                IPv6 адрес
  =====================   =====================  =========================
  база данных, сервер 1   couch1.db.rcsnet.ru    fd75:9fac:a7b1:92:6c::901
  база данных, сервер 2   couch2.db.rcsnet.ru1   fd75:9fac:a7b1:92:6c::902
  сервер приложений 1     kazoo1.app.rcsnet.ru   fd75:9fac:a7b1:92:6c::801
  сервер приложений 2     kazoo2.app.rcsnet.ru   fd75:9fac:a7b1:92:6c::802
  sip-сервер 1            fs1.voip.rcsnet.ru     fd75:9fac:a7b1:92:6c::601
  sip-сервер 2            fs1.voip.rcsnet.ru     fd75:9fac:a7b1:92:6c::601
  веб-сервер 1            nginx1.http.rcsnet.ru  fd75:9fac:a7b1:92:6c::601
  веб-сервер 2            nginx2.http.rcsnet.ru  fd75:9fac:a7b1:92:6c::601
  =====================   =====================  =========================

Более подробное описание каждого типа серверов приведено ниже по тексту.

Базы данных
-----------

В качестве базы данных используется продукт `CouchDB <http://couchdb.apache.org/>`_. Между серверами настроена `репликация данных <https://wiki.apache.org/couchdb/Replication>`_.
Дополнительно на серверах установлено програмное обеспечение `RabbitMQ <https://www.rabbitmq.com/>`_. Данное ПО предназначено для обмена сообщениями между серверами приложений. ПО RabbitMQ акже организованно в `кластер <https://www.rabbitmq.com/clustering.html>`_.


Сервера приложений
------------------

В качестве серверов приложений используется продукт `Kazoo <http://wiki.2600hz.com/>`_. На серверах приложений работают службы "whapps" и
"ecallmgr". между которыми организован обмен сообщеними через "RabbitMQ" на серверах баз данных. Служба "whapps" взаимодейсвует с "CouchDB"
на серверах баз данных. Служба "ecallmgr" взаимодействует с sip-серверами.

sip-сервера
-----------

В качестве sip-серверов используется продукт `FreeSwitch <https://freeswitch.org/>`_. Сервера настроены таким образом, что вся обработка
телефонных вызовов производится на серверах приложений, а sip-сервера выполняют команды серверов приложений (инициироать вызов, завершить
вызов, проиграть голосовое уведомление и т.п.).

Веб-сервера
-----------

В качестве веб-серверов используется продуукт `Nginx <http://nginx.org/>`_. Веб-сервера обеспечивают работу личного кабиента пользователей,
защиту от атак службы вебсокетов sip-серверов и служюы json api серверов приложений.

"Плавающие" IP адреса
---------------------


Вирутальные машины базы данных, sip-сервера и веб-сервера организованны в кластера высокой доступности на базе технологии "плавающего IP адреса" (shared IP).

.. table:: Перечень "плавающих" IP адресов

  =====================   =====================  =========================  ==============
  Наименование сервера    DNS имя                IPv6 адрес                 IPv4 адрес
  =====================   =====================  =========================  ==============
  база данных, сервер 1   couch.db.rcsnet.ru     fd75:9fac:a7b1:92:6c::900
  sip-сервер              pbx.rcsnet.ru                                     91.103.196.13
  веб-сервер              self.rcsnet.ru                                    217.12.243.138
  =====================   =====================  =========================  ==============

